"use strict";(self.webpackChunkjustinszaro_com_docs=self.webpackChunkjustinszaro_com_docs||[]).push([[766],{7348:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"technologies/React/Packages/TanStackQuery/getting-started","title":"TanStackQuery","description":"- TanStackQuery is a powerful asynchronous state management for the following languages/frameworks:","source":"@site/docs/technologies/React/Packages/TanStackQuery/getting-started.md","sourceDirName":"technologies/React/Packages/TanStackQuery","slug":"/technologies/React/Packages/TanStackQuery/getting-started","permalink":"/docs/technologies/React/Packages/TanStackQuery/getting-started","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"technologies","next":{"title":"TanStackQuery Guides and Concepts","permalink":"/docs/technologies/React/Packages/TanStackQuery/guides-and-concepts"}}');var a=t(4848),i=t(8453);const r={},o="TanStackQuery",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Motivation",id:"motivation",level:3},{value:"Code Example",id:"code-example",level:3},{value:"Installation",id:"installation",level:2},{value:"NPM:",id:"npm",level:4},{value:"PNPM",id:"pnpm",level:4},{value:"Yarn",id:"yarn",level:4},{value:"Bun",id:"bun",level:4},{value:"CDN:",id:"cdn",level:4},{value:"Recommendations",id:"recommendations",level:3},{value:"NPM:",id:"npm-1",level:4},{value:"PNPM",id:"pnpm-1",level:4},{value:"Yarn",id:"yarn-1",level:4},{value:"Bun",id:"bun-1",level:4},{value:"Quick Start",id:"quick-start",level:2},{value:"Devtools",id:"devtools",level:2},{value:"Installing the Dev Tools",id:"installing-the-dev-tools",level:3},{value:"NPM:",id:"npm-2",level:4},{value:"PNPM",id:"pnpm-2",level:4},{value:"Yarn",id:"yarn-2",level:4},{value:"Bun",id:"bun-2",level:4},{value:"Floating Mode",id:"floating-mode",level:3},{value:"Embedded Mode",id:"embedded-mode",level:3},{value:"Devtools in Production",id:"devtools-in-production",level:3},{value:"GraphQL",id:"graphql",level:2},{value:"React Native",id:"react-native",level:2},{value:"Online Status Management",id:"online-status-management",level:3},{value:"Refetch on App Focus",id:"refetch-on-app-focus",level:3},{value:"Refresh on Screen Focus",id:"refresh-on-screen-focus",level:3},{value:"Disable Queries on Out Of Focus Screens",id:"disable-queries-on-out-of-focus-screens",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"tanstackquery",children:"TanStackQuery"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["TanStackQuery is a powerful asynchronous state management for the following languages/frameworks:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Typescript"}),"\n",(0,a.jsx)(n.li,{children:"Javascript"}),"\n",(0,a.jsx)(n.li,{children:"React"}),"\n",(0,a.jsx)(n.li,{children:"Solid"}),"\n",(0,a.jsx)(n.li,{children:"Vue"}),"\n",(0,a.jsx)(n.li,{children:"Svelte"}),"\n",(0,a.jsx)(n.li,{children:"Angular"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["TanStackQuery is declarative and automatic.","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"TanStackQuery handles caching, background updates, and stale data out of the box with zero configurations."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["TanStackQuery is simple and familiar.","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"If you can work with promises or async/await, you already know how to use TanStackQuery."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["TanStackQuery is extensible:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"It is configured down to each observer instance with knobs and options to fit every use-case."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"TanStackQuery makes fetching, caching, synchronizing, and updating the server state a breeze."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"motivation",children:"Motivation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"React does not come with an opinionated way of fetching or updating data from your components, so developers are forced to make their own way."}),"\n",(0,a.jsxs)(n.li,{children:["While traditional state management libraries are great for working with the client state, they are not great with working with async or server state. This is due to server states being completely different:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Is persisted remotely in a location you do not control or own."}),"\n",(0,a.jsx)(n.li,{children:"Required asynchronous APIs for updating and fetching."}),"\n",(0,a.jsx)(n.li,{children:"Implies shared ownership and can be changed by other people without your knowledge."}),"\n",(0,a.jsx)(n.li,{children:'Can potentially become "out of date" with your application if you\'re not careful.'}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Once the server state is grasped, more challenges arise:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Caching... (possibly the hardest thing to do in programming)"}),"\n",(0,a.jsx)(n.li,{children:"Deduping multiple requests for the same data into a single request"}),"\n",(0,a.jsx)(n.li,{children:'Updating "out of date" data in the background'}),"\n",(0,a.jsx)(n.li,{children:'Knowing when data is "out of date"'}),"\n",(0,a.jsx)(n.li,{children:"Reflecting updates to data as quickly as possible"}),"\n",(0,a.jsx)(n.li,{children:"Performance optimizations like pagination and lazy loading data"}),"\n",(0,a.jsx)(n.li,{children:"Managing memory and garbage collection of server state"}),"\n",(0,a.jsx)(n.li,{children:"Memorizing query results with structural sharing"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"TanStackQuery works out of the box, with zero configuration needed."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"code-example",children:"Code Example"}),"\n",(0,a.jsxs)(n.p,{children:["See ",(0,a.jsx)(n.code,{children:"examples/React/ReactQuery/basic-example"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,a.jsx)(n.h4,{id:"npm",children:"NPM:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"npm i @tanstack/react-query\n"})}),"\n",(0,a.jsx)(n.h4,{id:"pnpm",children:"PNPM"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"pnpm add @tanstack/react-query\n"})}),"\n",(0,a.jsx)(n.h4,{id:"yarn",children:"Yarn"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"yarn add @tanstack/react-query\n"})}),"\n",(0,a.jsx)(n.h4,{id:"bun",children:"Bun"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"bun add @tanstack/react-query\n"})}),"\n",(0,a.jsx)(n.h4,{id:"cdn",children:"CDN:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",children:'<script type="module">\n  import React from "https://esm.sh/react@18.2.0";\n  import ReactDOM from "https://esm.sh/react-dom@18.2.0";\n  import { QueryClient } from "https://esm.sh/@tanstack/react-query";\n<\/script>\n'})}),"\n",(0,a.jsx)(n.h3,{id:"recommendations",children:"Recommendations"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"It is recommended to install the ESLint Plugin Query to help catch bugs and inconsistencies:"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"npm-1",children:"NPM:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"npm i -D @tanstack/eslint-plugin-query\n"})}),"\n",(0,a.jsx)(n.h4,{id:"pnpm-1",children:"PNPM"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"pnpm add -D @tanstack/eslint-plugin-query\n"})}),"\n",(0,a.jsx)(n.h4,{id:"yarn-1",children:"Yarn"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"yarn add -D @tanstack/eslint-plugin-query\n"})}),"\n",(0,a.jsx)(n.h4,{id:"bun-1",children:"Bun"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"bun add -D @tanstack/eslint-plugin-query\n"})}),"\n",(0,a.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The following example shows the three core concepts of TanStackQuery:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Queries"}),"\n",(0,a.jsx)(n.li,{children:"Mutations"}),"\n",(0,a.jsx)(n.li,{children:"Query Invalidation"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'import {\n  useQuery,\n  useMutation,\n  useQueryClient,\n  QueryClient,\n  QueryClientProvider,\n} from "@tanstack/react-query";\nimport { getTodos, postTodo } from "../my-api";\n\n// Create a client\nconst queryClient = new QueryClient();\n\nfunction App() {\n  return (\n    // Provide the client to your App\n    <QueryClientProvider client={queryClient}>\n      <Todos />\n    </QueryClientProvider>\n  );\n}\n\nfunction Todos() {\n  // Access the client\n  const queryClient = useQueryClient();\n\n  // Queries\n  const query = useQuery({ queryKey: ["todos"], queryFn: getTodos });\n\n  // Mutations\n  const mutation = useMutation({\n    mutationFn: postTodo,\n    onSuccess: () => {\n      // Invalidate and refetch\n      queryClient.invalidateQueries({ queryKey: ["todos"] });\n    },\n  });\n\n  return (\n    <div>\n      <ul>\n        {query.data?.map((todo) => (\n          <li key={todo.id}>{todo.title}</li>\n        ))}\n      </ul>\n\n      <button\n        onClick={() => {\n          mutation.mutate({\n            id: Date.now(),\n            title: "Do Laundry",\n          });\n        }}\n      >\n        Add Todo\n      </button>\n    </div>\n  );\n}\n\nrender(<App />, document.getElementById("root"));\n'})}),"\n",(0,a.jsx)(n.h2,{id:"devtools",children:"Devtools"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"TanStackQuery comes with dedicated DevTools"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"installing-the-dev-tools",children:"Installing the Dev Tools"}),"\n",(0,a.jsx)(n.h4,{id:"npm-2",children:"NPM:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"npm i -D @tanstack/react-query-devtools\n"})}),"\n",(0,a.jsx)(n.h4,{id:"pnpm-2",children:"PNPM"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"pnpm add -D @tanstack/react-query-devtools\n"})}),"\n",(0,a.jsx)(n.h4,{id:"yarn-2",children:"Yarn"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"yarn add -D @tanstack/react-query-devtools\n"})}),"\n",(0,a.jsx)(n.h4,{id:"bun-2",children:"Bun"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"bun add -D @tanstack/react-query-devtools\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"You can import the devtools using:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'import { ReactQueryDevtools } from "@tanstack/react-query-devtools";\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["By default, they are only loaded when ",(0,a.jsx)(n.code,{children:"process.env.NODE_ENV === 'development'"})]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"floating-mode",children:"Floating Mode"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Floating Mode will mount the devtools as a fixed, floating element in your app and provide a toggle in the corner of the screen."}),"\n",(0,a.jsx)(n.li,{children:"The toggle state is stored and loaded in localstorage."}),"\n",(0,a.jsx)(n.li,{children:"To enable, add this to the React app as close to the root as possible."}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { ReactQueryDevtools } from "@tanstack/react-query-devtools";\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      {/* The rest of your application */}\n      <ReactQueryDevtools initialIsOpen={false} />\n    </QueryClientProvider>\n  );\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"embedded-mode",children:"Embedded Mode"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Embedded move will show them as a fixed element in the application, so you use the panel in your own development tools."}),"\n",(0,a.jsx)(n.li,{children:"To enable, add this to the React app as close to the root as possible."}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { ReactQueryDevtoolsPanel } from "@tanstack/react-query-devtools";\n\nfunction App() {\n  const [isOpen, setIsOpen] = React.useState(false);\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      {/* The rest of your application */}\n      <button onClick={() => setIsOpen(!isOpen)}>{`${\n        isOpen ? "Close" : "Open"\n      } the devtools panel`}</button>\n      {isOpen && <ReactQueryDevtoolsPanel onClose={() => setIsOpen(false)} />}\n    </QueryClientProvider>\n  );\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"devtools-in-production",children:"Devtools in Production"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Devtools are excluded in Production Builds. However, it may be beneficial to lazy load them."}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'import * as React from "react";\nimport { QueryClient, QueryClientProvider } from "@tanstack/react-query";\nimport { ReactQueryDevtools } from "@tanstack/react-query-devtools";\nimport { Example } from "./Example";\n\nconst queryClient = new QueryClient();\n\nconst ReactQueryDevtoolsProduction = React.lazy(() =>\n  import("@tanstack/react-query-devtools/build/modern/production.js").then(\n    (d) => ({\n      default: d.ReactQueryDevtools,\n    })\n  )\n);\n\nfunction App() {\n  const [showDevtools, setShowDevtools] = React.useState(false);\n\n  React.useEffect(() => {\n    // @ts-expect-error\n    window.toggleDevtools = () => setShowDevtools((old) => !old);\n  }, []);\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <Example />\n      <ReactQueryDevtools initialIsOpen />\n      {showDevtools && (\n        <React.Suspense fallback={null}>\n          <ReactQueryDevtoolsProduction />\n        </React.Suspense>\n      )}\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Calling ",(0,a.jsx)(n.code,{children:"window.toggleDevtools()"})," will download the devtools bundle and show them."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"graphql",children:"GraphQL"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Because TanStackQuery's fetching mechanism are built on Promises, you can use it with GraphQL!"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"react-native",children:"React Native"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Devtools do not work with React Native (Which is why MarketingCloud probably doesn't use it)."}),"\n",(0,a.jsx)(n.li,{children:"Devtools only work with React DOM."}),"\n",(0,a.jsx)(n.li,{children:"TanStackQuery will work out-of-the-box with React Native."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"online-status-management",children:"Online Status Management"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["TanStackQuery supports auto refetch on reconnect in a web browser. To add the behavior, you need to use TanStackQuery ",(0,a.jsx)(n.code,{children:"onlineManager"})]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'import NetInfo from "@react-native-community/netinfo";\nimport { onlineManager } from "@tanstack/react-query";\n\nonlineManager.setEventListener((setOnline) => {\n  return NetInfo.addEventListener((state) => {\n    setOnline(!!state.isConnected);\n  });\n});\n'})}),"\n",(0,a.jsx)(n.p,{children:"or"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { onlineManager } from "@tanstack/react-query";\nimport * as Network from "expo-network";\n\nonlineManager.setEventListener((setOnline) => {\n  return Network.addNetworkStateListener((state) => {\n    setOnline(state.isConnected);\n  });\n});\n'})}),"\n",(0,a.jsx)(n.h3,{id:"refetch-on-app-focus",children:"Refetch on App Focus"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Instead of listeners, React native provides focus information through the ",(0,a.jsx)(n.code,{children:"AppState"})," module."]}),"\n",(0,a.jsxs)(n.li,{children:["You can use the ",(0,a.jsx)(n.code,{children:"AppState"}),' "change" event to trigger an update when the app state changes to active.']}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { useEffect } from "react";\nimport { AppState, Platform } from "react-native";\nimport type { AppStateStatus } from "react-native";\nimport { focusManager } from "@tanstack/react-query";\n\nfunction onAppStateChange(status: AppStateStatus) {\n  if (Platform.OS !== "web") {\n    focusManager.setFocused(status === "active");\n  }\n}\n\nuseEffect(() => {\n  const subscription = AppState.addEventListener("change", onAppStateChange);\n\n  return () => subscription.remove();\n}, []);\n'})}),"\n",(0,a.jsx)(n.h3,{id:"refresh-on-screen-focus",children:"Refresh on Screen Focus"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"In some situations, you may want to refetch the query when the screen is focused again."}),"\n",(0,a.jsx)(n.li,{children:"The following custom hook will call the refetch function once the screen is focused again."}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import React from "react";\nimport { useFocusEffect } from "@react-navigation/native";\n\nexport function useRefreshOnFocus<T>(refetch: () => Promise<T>) {\n  const firstTimeRef = React.useRef(true);\n\n  useFocusEffect(\n    React.useCallback(() => {\n      if (firstTimeRef.current) {\n        firstTimeRef.current = false;\n        return;\n      }\n\n      refetch();\n    }, [refetch])\n  );\n}\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The first refetch is skipped because the useFocusEffect calls the callback on mount in additional to screen focus."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"disable-queries-on-out-of-focus-screens",children:"Disable Queries on Out Of Focus Screens"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:['If you don\'t want certain queries to remain "live" when the screen is out of focus, you can use the ',(0,a.jsx)(n.code,{children:"subscribed"})," prop on useQuery."]}),"\n",(0,a.jsx)(n.li,{children:"It allows you to control when a query stays subscribed to updates."}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"import React from 'react'\nimport { useIsFocused } from '@react-navigation/native'\nimport { useQuery } from '@tanstack/react-query'\nimport { Text } from 'react-native'\n\nfunction MyComponent() {\n  const isFocused = useIsFocused()\n\n  const { dataUpdatedAt } = useQuery({\n    queryKey: ['key'],\n    queryFn: () => fetch(...),\n    subscribed: isFocused,\n  })\n\n  return <Text>DataUpdatedAt: {dataUpdatedAt}</Text>\n}\n"})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var s=t(6540);const a={},i=s.createContext(a);function r(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);